# AWS Secrets Manager Configuration
# Using AWS Secrets Manager for cloud-native secret management

aws:
  region: us-east-1
  secrets_manager:
    # Secret ARNs
    secrets:
      database:
        arn: arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/database
        version: AWSCURRENT
        keys:
          - username
          - password
          - host
          - port

      api_keys:
        arn: arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/api-keys
        version: AWSCURRENT
        keys:
          - payment_gateway
          - analytics
          - email_service

      oauth:
        arn: arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/oauth
        version: AWSCURRENT
        keys:
          - client_id
          - client_secret

    # Rotation configuration
    rotation:
      database:
        enabled: true
        lambda_arn: arn:aws:lambda:us-east-1:123456789012:function:rotate-db-secret
        schedule: rate(30 days)

      api_keys:
        enabled: true
        lambda_arn: arn:aws:lambda:us-east-1:123456789012:function:rotate-api-keys
        schedule: rate(90 days)

# Application configuration with AWS Secrets Manager
application:
  database:
    # Reference secrets by ARN
    host: ${aws:secretsmanager:arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/database:host}
    port: ${aws:secretsmanager:arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/database:port}
    username: ${aws:secretsmanager:arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/database:username}
    password: ${aws:secretsmanager:arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/database:password}

  api:
    payment_gateway:
      api_key: ${aws:secretsmanager:arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/api-keys:payment_gateway}

  oauth:
    client_id: ${aws:secretsmanager:arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/oauth:client_id}
    client_secret: ${aws:secretsmanager:arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/oauth:client_secret}

# ECS Task Definition with Secrets Manager
ecs_task_definition:
  containerDefinitions:
    - name: myapp
      image: myapp:latest
      secrets:
        - name: DB_PASSWORD
          valueFrom: arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/database:password::
        - name: API_KEY
          valueFrom: arn:aws:secretsmanager:us-east-1:123456789012:secret:myapp/api-keys:payment_gateway::
